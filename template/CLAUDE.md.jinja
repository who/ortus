# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## AI Guidance

* After receiving tool results, carefully reflect on their quality and determine optimal next steps before proceeding.
* For maximum efficiency, invoke multiple independent operations simultaneously rather than sequentially.
* Before you finish, verify your solution.
* Do what has been asked; nothing more, nothing less.
* NEVER create files unless absolutely necessary for achieving your goal.
* ALWAYS prefer editing an existing file to creating a new one.
* NEVER proactively create documentation files (*.md) or README files unless explicitly requested.

## Work Execution Policy

**All implementation work MUST go through Ralph loops.**

When asked to implement features, fix bugs, or make code changes:

1. **Do NOT implement directly** - Instead, create beads issues with detailed descriptions
2. **Create well-structured issues** - Use `bd create` with clear titles, descriptions, and acceptance criteria
3. **Set up dependencies** - Use `bd dep add` to establish proper ordering
4. **Defer to Ralph** - The `ralph.sh` loop will execute the actual work via PROMPT.md

**Allowed without Ralph loop:**
- Answering questions about the codebase
- Reading/exploring files for research
- Creating beads issues
- Discussing architecture or approach

**Requires Ralph loop:**
- Writing or modifying code
- Creating new files
- Running tests or builds
- Any implementation work

This ensures all work is tracked, atomic, and follows the defined workflow.

## Project Overview

{{ project_description }}

## Technology Stack

- **Language**: {{ language | capitalize }}
{%- if package_manager != 'none' %}
- **Package Manager**: {{ package_manager }}
{%- endif %}
{%- if framework != 'none' %}
- **Framework**: {{ framework }}
{%- endif %}
{%- if linter != 'none' %}
- **Linter**: {{ linter }}
{%- endif %}

## Development Guidelines

### Code Standards

{%- if language == 'python' %}
* Type hints required for all functions
* Use Pydantic models for data validation
* Follow Google Python Style Guide
{%- if linter == 'ruff' %}
* Use `ruff` for linting and formatting
{%- endif %}
{%- if package_manager == 'uv' %}
* Use `uv` for dependency management (not pip)
{%- endif %}
{%- elif language == 'typescript' %}
* TypeScript strict mode enabled
* Use interfaces for object shapes
* Follow Airbnb JavaScript Style Guide
{%- if linter == 'eslint' %}
* Use `eslint` for linting
{%- endif %}
{%- elif language == 'go' %}
* Follow Effective Go guidelines
* Use `gofmt` for formatting
{%- if linter == 'golangci' %}
* Use `golangci-lint` for linting
{%- endif %}
{%- elif language == 'rust' %}
* Follow Rust API Guidelines
* Use `rustfmt` for formatting
{%- if linter == 'clippy' %}
* Use `clippy` for linting
{%- endif %}
{%- else %}
<!-- TODO: Define your code standards -->
{%- endif %}

### Before Committing

{%- if language == 'python' and package_manager == 'uv' %}
1. Run `uv run ruff check .` and `uv run ruff format .`
2. Run `uv run pytest` if tests exist
3. Stage changes appropriately
{%- elif language == 'typescript' %}
1. Run `{{ package_manager }} run lint`
2. Run `{{ package_manager }} test` if tests exist
3. Stage changes appropriately
{%- elif language == 'go' %}
1. Run `go fmt ./...`
2. Run `golangci-lint run`
3. Run `go test ./...`
4. Stage changes appropriately
{%- elif language == 'rust' %}
1. Run `cargo fmt`
2. Run `cargo clippy`
3. Run `cargo test`
4. Stage changes appropriately
{%- else %}
<!-- TODO: Define your pre-commit checklist -->
{%- endif %}

## Command Reference

### Development

{%- if language == 'python' and package_manager == 'uv' %}
```bash
# Setup (first time)
uv sync                              # Install all dependencies
uv venv                              # Create virtual environment (if needed)

# Run development server
{%- if framework == 'fastapi' %}
uv run uvicorn app.main:app --reload --port 8000
{%- elif framework == 'flask' %}
uv run flask --app app.main run --port 8000
{%- elif framework == 'django' %}
uv run python manage.py runserver
{%- else %}
uv run python -m app.main
{%- endif %}

# Run tests
uv run pytest

# Linting
uv run ruff check .
uv run ruff format .

# Add dependencies
uv add <package>                     # Add to main dependencies
uv add --dev <package>               # Add to dev dependencies
```
{%- elif language == 'typescript' %}
```bash
# Setup (first time)
{{ package_manager }} install

# Run development server
{{ package_manager }} run dev

# Run tests
{{ package_manager }} test

# Linting
{{ package_manager }} run lint
{{ package_manager }} run format
```
{%- elif language == 'go' %}
```bash
# Setup (first time)
go mod download

# Run development server
go run ./cmd/server

# Run tests
go test ./...

# Linting
golangci-lint run
go fmt ./...
```
{%- elif language == 'rust' %}
```bash
# Build
cargo build

# Run
cargo run

# Run tests
cargo test

# Linting
cargo clippy
cargo fmt
```
{%- else %}
<!-- TODO: Add your development commands -->
{%- endif %}

### File Operations - Use Fast Tools

```bash
# List files (FAST)
fd . -t f           # All files recursively
rg --files          # All files (respects .gitignore)
fd . -t d           # All directories

# Search content (FAST)
rg "search_term"                # Search in all files
rg -i "case_insensitive"        # Case-insensitive
rg "pattern" -g "*.ext"         # Only specific file type
rg -l "pattern"                 # Filenames with matches
rg -c "pattern"                 # Count matches per file
rg -n "pattern"                 # Show line numbers
rg -A 3 -B 3 "pattern"          # Context lines

# Find files by name (FAST)
fd "filename"                   # Find by name pattern
fd -e ext                       # All files with extension
```

### Banned Commands - Avoid These Slow Tools

* `tree` - use `fd` instead
* `find` - use `fd` or `rg --files`
* `grep` or `grep -r` - use `rg` instead
* `ls -R` - use `rg --files` or `fd`
* `cat file | grep` - use `rg pattern file`

### Search Strategy

1. Start broad, then narrow: `rg "partial" | rg "specific"`
2. Filter by type early: `rg "pattern" -g "*.ext"`
3. Batch patterns: `rg "(pattern1|pattern2|pattern3)"`
4. Limit scope: `rg "pattern" src/`

## Project Architecture

### File Structure

```
{{ project_name }}/
├── src/                      # Source code
├── tests/                    # Test suite (optional)
├── prd/                      # Product requirements documents
├── .beads/                   # Issue tracking
├── .claude/                  # Claude Code settings
└── CLAUDE.md                 # This file
```

## Issue Tracking

This project uses **beads** (`bd`) for issue tracking. See **AGENTS.md** for workflow and session protocol.

### Beads Visualization

View your issues in a visual interface:
- [bdui](https://github.com/assimelha/bdui) - Web-based beads visualization

Or use the CLI:
```bash
bd list              # List all issues
bd ready             # Show issues ready to work
bd stats             # Project statistics
```

## Important Files

* **CLAUDE.md** - AI agent instructions (this file)
* **AGENTS.md** - Session rules and landing-the-plane protocol
* **PROMPT.md** - Ralph loop task instructions
* **ralph.sh** - Task implementation loop
* **interview.sh** - Interactive feature interview with Claude
* **prd/PRD-PROMPT.md** - Manual PRD generation template

## Pro Tips for AI Agents

* Always use `--json` flags when available for programmatic use
* Use dependency trees to understand complex relationships
* Higher priority issues (0-1) are usually more important than lower (2-4)
